<p-panel *ngIf="!isLoading; else spinner">
    <ng-template pTemplate="header">
        <span class="font-bold w-full text-center" style="font-size: 20px"
            >Examen de Valoracion</span
        >
    </ng-template>
    <div class="col flex align-items-center justify-content-center">
        <p-card
            class="m-2 w-full max-w-30rem"
            header="Datos del Estudiante"
            *ngIf="estudianteSeleccionado"
        >
            <div class="mt-2 card-data flex justify-content-between">
                <span>Codigo</span>
                <span>{{ estudianteSeleccionado.codigo }}</span>
            </div>
            <div class="mt-2 card-data flex justify-content-between">
                <span>Numero de Identificacion</span>
                <span>{{ estudianteSeleccionado.identificacion }}</span>
            </div>
            <div class="mt-2 card-data flex justify-content-between">
                <span>Nombres y Apellidos</span>
                <span
                    >{{ estudianteSeleccionado.nombre }}
                    {{ estudianteSeleccionado.apellido }}</span
                >
            </div>
        </p-card>
    </div>
    <div class="flex mt-4 justify-content-between">
        <div class="flex align-items-center column-gap-4">
            <button
                pButton
                type="button"
                (click)="redirectToBandeja()"
                [disabled]="
                    !!this.solicitudId ? !!this.solicitudId : isActiveIndex()
                "
            >
                SOLICITUD
            </button>
            <button
                pButton
                type="button"
                [disabled]="!this.isSolicitudValid"
                (click)="rediectToRespuesta(this.respuestaId)"
            >
                RESPUESTA
            </button>
        </div>
        <div class="flex align-items-center">
            <button
                *ngIf="!editMode"
                pButton
                type="button"
                icon="pi pi-save"
                label="Modificar Informacion"
                (click)="onEdit(this.solicitudId)"
            ></button>
            <button
                *ngIf="editMode"
                pButton
                icon="pi pi-save"
                label="Guardar"
                (click)="redirectToBandeja()"
            ></button>
        </div>
    </div>
    <ng-template class="w-full" pTemplate="footer">
        <form [formGroup]="solicitudForm" enctype="multipart/form-data">
            <div class="flex flex-column gap-2">
                <div class="text-center font-medium mb-4">
                    <p>
                        <b
                            >Información asociada a la solicitud del examen de
                            valoracion</b
                        >
                    </p>
                </div>
                <div class="field grid">
                    <div class="col-5 col-label text-right align-self-center">
                        <label class="label-required"
                            >Título del Trabajo de Investigacion</label
                        >
                    </div>
                    <div class="col-7 col-input">
                        <input
                            pInputText
                            [maxLength]="250"
                            class="p-inputtext-md w-full max-w-30rem"
                            formControlName="titulo"
                            [ngClass]="{
                                'ng-invalid ng-dirty':
                                    getFormControl('titulo').invalid &&
                                    getFormControl('titulo').touched
                            }"
                        />
                    </div>
                </div>
                <div class="field grid">
                    <div class="col-5 col-label text-right align-self-center">
                        <label class="label-required"
                            >Solicitud Examen de Valoracion (Formato A .pdf)
                        </label>
                    </div>
                    <div class="col-7 col-input">
                        <div
                            class="flex flex-wrap gap-2 max-w-30rem align-items-start"
                        >
                            <div
                                class="flex flex-column row-gap-2 align-items-start justify-content-start flex-1"
                            >
                                <div
                                    class="flex flex-row w-full justify-content-between"
                                >
                                    <p-fileUpload
                                        #fileUpload1
                                        name="doc_solicitud_valoracion"
                                        mode="basic"
                                        [auto]="true"
                                        accept=".pdf"
                                        chooseIcon="pi pi-file"
                                        class="w-full max-w-30rem"
                                        maxFileSize="2000000"
                                        invalidFileSizeMessage="El tamaño del archivo supera el límite de 2 MB"
                                        (onSelect)="onFileSelectFirst($event)"
                                        chooseLabel="Buscar documento"
                                    >
                                    </p-fileUpload>
                                    <button
                                        *ngIf="selectedFileFirst"
                                        pButton
                                        icon="pi pi-times"
                                        type="button"
                                        (click)="
                                            onFileClear(
                                                'doc_solicitud_valoracion'
                                            )
                                        "
                                    ></button>
                                </div>
                                <div class="mt-2" *ngIf="selectedFileFirst">
                                    {{ selectedFileFirst.name }}.pdf -
                                    {{ selectedFileFirst.size | bytesToKb }}
                                    KB
                                </div>
                            </div>
                            <button
                                *ngIf="selectedFileFirst"
                                pButton
                                type="button"
                                icon="pi pi-download"
                                (click)="
                                    getFileAndSetValue(
                                        'doc_solicitud_valoracion'
                                    )
                                "
                            ></button>
                            <button
                                *ngIf="!selectedFileFirst"
                                pButton
                                icon="pi pi-plus"
                                class="align-self-center"
                                label="Crear Documento"
                                (click)="onCrearDocumento()"
                                [loading]="loading"
                            ></button>
                        </div>
                        <div class="mt-2" *ngIf="!selectedFileFirst">
                            <p>No has seleccionado ningún documento.</p>
                        </div>
                    </div>
                </div>
                <div class="field grid">
                    <div class="col-5 col-label text-right align-self-center">
                        <label class="label-required"
                            >Anteproyecto presentado a Examen (Formato D .pdf,
                            .rar, .zip)
                        </label>
                    </div>
                    <div class="col-7 col-input">
                        <div
                            class="flex flex-wrap gap-2 max-w-30rem align-items-start"
                        >
                            <div
                                class="flex flex-column row-gap-2 align-items-start justify-content-start flex-1"
                            >
                                <div
                                    class="flex flex-row w-full justify-content-between"
                                >
                                    <p-fileUpload
                                        #fileUpload2
                                        name="doc_anteproyecto_examen"
                                        mode="basic"
                                        [auto]="true"
                                        accept=".pdf,.zip,.rar"
                                        chooseIcon="pi pi-file"
                                        class="w-full max-w-30rem"
                                        maxFileSize="5000000"
                                        (onSelect)="onFileSelectSecond($event)"
                                        chooseLabel="Buscar documento"
                                    >
                                    </p-fileUpload>
                                    <button
                                        *ngIf="selectedFileSecond"
                                        pButton
                                        icon="pi pi-times"
                                        type="button"
                                        (click)="
                                            onFileClear(
                                                'doc_anteproyecto_examen'
                                            )
                                        "
                                    ></button>
                                </div>
                                <div class="mt-2" *ngIf="selectedFileSecond">
                                    {{ selectedFileSecond.name }}.pdf -
                                    {{ selectedFileSecond.size | bytesToKb }}
                                    KB
                                </div>
                            </div>
                            <button
                                *ngIf="selectedFileSecond"
                                pButton
                                type="button"
                                icon="pi pi-download"
                                (click)="
                                    getFileAndSetValue(
                                        'doc_anteproyecto_examen'
                                    )
                                "
                            ></button>
                        </div>
                        <div class="mt-2" *ngIf="!selectedFileSecond">
                            <p>No has seleccionado ningún documento.</p>
                        </div>
                    </div>
                </div>
                <div class="field grid">
                    <div class="col-5 col-label text-right align-self-center">
                        <label
                            >Examen de valoración (Formato E, .pdf, .rar, .zip)
                        </label>
                    </div>
                    <div class="col-7 col-input">
                        <div
                            class="flex flex-wrap gap-2 max-w-30rem align-items-start"
                        >
                            <div
                                class="flex flex-column row-gap-2 align-items-start justify-content-start flex-1"
                            >
                                <div
                                    class="flex flex-row w-full justify-content-between"
                                >
                                    <p-fileUpload
                                        #fileUpload3
                                        mode="basic"
                                        [auto]="true"
                                        name="doc_examen_valoracion"
                                        chooseIcon="pi pi-file"
                                        accept=".pdf,.zip,.rar"
                                        class="w-full max-w-30rem"
                                        maxFileSize="5000000"
                                        (onSelect)="onFileSelectThird($event)"
                                        chooseLabel="Buscar documento"
                                    ></p-fileUpload>
                                    <button
                                        *ngIf="selectedFileThird"
                                        pButton
                                        icon="pi pi-times"
                                        type="button"
                                        (click)="
                                            onFileClear('doc_examen_valoracion')
                                        "
                                    ></button>
                                </div>
                                <div class="mt-2" *ngIf="selectedFileThird">
                                    {{ selectedFileThird.name }}.pdf -
                                    {{ selectedFileThird.size | bytesToKb }}
                                    KB
                                </div>
                            </div>
                            <button
                                *ngIf="selectedFileThird"
                                pButton
                                type="button"
                                icon="pi pi-download"
                                (click)="
                                    getFileAndSetValue('doc_examen_valoracion')
                                "
                            ></button>
                        </div>
                        <div class="mt-2" *ngIf="!selectedFileThird">
                            <p>No has seleccionado ningún documento.</p>
                        </div>
                    </div>
                </div>
                <div class="field grid">
                    <div class="col-5 col-label text-right align-self-center">
                        <label class="label-required">Evaluador Externo</label>
                    </div>
                    <div
                        class="col-7 col-input"
                        *ngIf="expertoSeleccionado; else noEvaluadorSelected"
                    >
                        <div class="flex align-items-center">
                            <p-card class="w-full max-w-30rem m-0">
                                <div class="flex justify-content-between">
                                    <span
                                        style="
                                            font-size: 18px;
                                            font-weight: bold;
                                        "
                                        >Datos del Evaluador Externo</span
                                    >
                                    <button
                                        pButton
                                        icon="pi pi-times"
                                        style="border: none; font-size: 1.2rem"
                                        (click)="limpiarExperto()"
                                    ></button>
                                </div>
                                <div class="mt-2 flex justify-content-between">
                                    <span>Nombres y Apellidos</span>
                                    <span
                                        >{{ expertoSeleccionado.nombre }}
                                        {{ expertoSeleccionado.apellido }}</span
                                    >
                                </div>
                                <div class="mt-2 flex justify-content-between">
                                    <span>Universidad</span>
                                    <span>{{
                                        expertoSeleccionado.universidad
                                    }}</span>
                                </div>
                                <div class="mt-2 flex justify-content-between">
                                    <span>Correo</span>
                                    <span>{{
                                        expertoSeleccionado.correo
                                    }}</span>
                                </div>
                            </p-card>
                        </div>
                    </div>
                    <div class="align-self-center" *ngIf="!expertoSeleccionado">
                        <button
                            pButton
                            icon="pi pi-plus"
                            label="Seleccionar Evaluador"
                            (click)="onSeleccionarExperto()"
                        ></button>
                    </div>
                </div>
                <div class="field grid">
                    <div class="col-5 col-label text-right align-self-center">
                        <label class="label-required">Evaluador Interno</label>
                    </div>
                    <div
                        class="col-7 col-input"
                        *ngIf="docenteSeleccionado; else noEvaluadorSelected"
                    >
                        <div class="flex align-items-center">
                            <p-card class="w-full max-w-30rem m-0">
                                <div class="flex justify-content-between">
                                    <span
                                        style="
                                            font-size: 18px;
                                            font-weight: bold;
                                        "
                                        >Datos del Evaluador Interno</span
                                    >
                                    <button
                                        pButton
                                        icon="pi pi-times"
                                        style="border: none; font-size: 1.2rem"
                                        (click)="limpiarDocente()"
                                    ></button>
                                </div>
                                <div class="mt-2 flex justify-content-between">
                                    <span>Nombres y Apellidos</span>
                                    <span
                                        >{{ docenteSeleccionado.nombre }}
                                        {{ docenteSeleccionado.apellido }}</span
                                    >
                                </div>
                                <div class="mt-2 flex justify-content-between">
                                    <span>Universidad</span>
                                    <span>{{
                                        docenteSeleccionado.universidad
                                    }}</span>
                                </div>
                                <div class="mt-2 flex justify-content-between">
                                    <span>Correo</span>
                                    <span>{{
                                        docenteSeleccionado.correo
                                    }}</span>
                                </div>
                            </p-card>
                        </div>
                    </div>
                    <div class="align-self-center" *ngIf="!docenteSeleccionado">
                        <button
                            pButton
                            icon="pi pi-plus"
                            label="Seleccionar Evaluador"
                            (click)="onSeleccionarDocente()"
                        ></button>
                    </div>
                </div>
                <div class="field grid">
                    <div class="col-5 col-label text-right align-self-center">
                        <label class="label-required"
                            >No Acta de aprobacion del examen</label
                        >
                    </div>
                    <div class="col-7 col-input">
                        <p-inputNumber
                            inputId="integeronly"
                            formControlName="numero_acta"
                            [ngClass]="{
                                'ng-invalid ng-dirty':
                                    getFormControl('numero_acta').invalid &&
                                    getFormControl('numero_acta').touched
                            }"
                        ></p-inputNumber>
                    </div>
                </div>
                <div class="field grid">
                    <div class="col-5 col-label text-right align-self-center">
                        <label>Fecha del Acta</label>
                    </div>
                    <div class="col-7 col-input">
                        <p-calendar
                            formControlName="fecha_acta"
                            [showIcon]="true"
                            dateFormat="dd.mm.yy"
                        ></p-calendar>
                    </div>
                </div>
                <div class="field grid">
                    <div class="col-5 col-label text-right align-self-center">
                        <label
                            >Ofcio dirigido a jurados sobre instrucciones para
                            el examen de valoración (.pdf)
                        </label>
                    </div>
                    <div class="col-7 col-input">
                        <div
                            class="flex flex-wrap gap-2 max-w-30rem align-items-start"
                        >
                            <div
                                class="flex flex-column row-gap-2 align-items-start justify-content-start flex-1"
                            >
                                <div
                                    class="flex flex-row w-full justify-content-between"
                                >
                                    <p-fileUpload
                                        #fileUpload4
                                        name="doc_oficio_jurados"
                                        mode="basic"
                                        [auto]="true"
                                        accept=".pdf"
                                        chooseIcon="pi pi-file"
                                        class="w-full max-w-30rem"
                                        maxFileSize="2000000"
                                        (onSelect)="onFileSelectFourth($event)"
                                        chooseLabel="Buscar documento"
                                    >
                                    </p-fileUpload>
                                    <button
                                        *ngIf="selectedFileFourth"
                                        pButton
                                        icon="pi pi-times"
                                        type="button"
                                        (click)="
                                            onFileClear('doc_oficio_jurados')
                                        "
                                    ></button>
                                </div>
                                <div class="mt-2" *ngIf="selectedFileFourth">
                                    {{ selectedFileFourth.name }}.pdf -
                                    {{ selectedFileFourth.size | bytesToKb }}
                                    KB
                                </div>
                            </div>
                            <button
                                *ngIf="selectedFileFourth"
                                pButton
                                type="button"
                                icon="pi pi-download"
                                (click)="
                                    getFileAndSetValue('doc_oficio_jurados')
                                "
                            ></button>
                        </div>
                        <div class="mt-2" *ngIf="!selectedFileFourth">
                            <p>No has seleccionado ningún documento.</p>
                        </div>
                    </div>
                </div>
            </div>
        </form>
    </ng-template>
</p-panel>
<ng-template #noEvaluadorSelected>
    <p-fieldset legend="Cargar Evaluador" class="mr-5"></p-fieldset>
</ng-template>
<ng-template #spinner>
    <p-progressSpinner ariaLabel="loading" class="spinner"></p-progressSpinner>
</ng-template>
